{
    "aggs": {
        "group_VOname": {
            "aggs": {
                "group_commonName": {
                    "aggs": {
                        "CPU_Duration": {
                            "sum": {
                                "field": "CpuDuration"
                            }
                        },
                        "Process_times_WallDur": {
                            "sum": {
                                "script": "(doc['WallDuration'].value*doc['Processors'].value)"
                            }
                        },
                        "Wall_Hours": {
                            "sum": {
                                "field": "CoreHours"
                            }
                        },
                        "test": {
                            "bucket_script": {
                                "buckets_path": {
                                    "CPUDuration": "CPU_Duration",
                                    "Pr_time_WallDur": "Process_times_WallDur"
                                },
                                "script": "CPUDuration/(Pr_time_WallDur * 3600)"
                            }
                        }
                    },
                    "terms": {
                        "field": "CommonName"
                    }
                }
            },
            "terms": {
                "field": "ReportableVOName"
            }
        }
    },
    "query": {
        "bool": {
            "filter": [
                {
                    "range": {
                        "EndTime": {
                            "gte": "2016-06-18T07:30",
                            "lt": "2016-06-19T07:30"
                        }
                    }
                },
                {
                    "range": {
                        "WallDuration": {
                            "gt": 0
                        }
                    }
                },
                {
                    "term": {
                        "ResourceType": "Payload"
                    }
                }
            ],
            "must": [
                {   
                    "regexp": {
                        "ReportableVOName": "uboone"
                    }   
                },  
                
                {
                    "wildcard": {
                        "ProbeName": "condor:fifebatch?.fnal.gov"
                    }
                }
            ]
        }
    }
}
